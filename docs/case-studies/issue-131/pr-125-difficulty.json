{"additions":10518,"body":"## Summary\n\nThis PR implements the feature requested in #114 with a **difficulty selection system**:\n\n- **Normal mode (default)**: Classic gameplay behavior\n  - 90 bullets (3 magazines)\n  - Enemies behave normally (no distraction attack)\n\n- **Hard mode**: Enhanced enemy AI\n  - 60 bullets (2 magazines)  \n  - Enemies **immediately attack** when player looks away (>23Â° from enemy direction)\n  - This is the highest priority action - bypasses all state logic and timers\n\n### Changes\n\n1. **DifficultyManager Autoload** (`scripts/autoload/difficulty_manager.gd`)\n   - Global singleton for managing difficulty settings\n   - Persists settings to disk (`user://difficulty_settings.cfg`)\n   - Provides `is_hard_mode()`, `is_distraction_attack_enabled()`, `get_max_ammo()` methods\n   - Emits `difficulty_changed` signal when difficulty changes\n\n2. **Difficulty Menu** (`scenes/ui/DifficultyMenu.tscn`, `scripts/ui/difficulty_menu.gd`)\n   - Accessible from pause menu (ESC â†’ Difficulty)\n   - Shows current difficulty with description\n   - Allows switching between Normal and Hard modes\n\n3. **Pause Menu Integration** (`scripts/ui/pause_menu.gd`, `scenes/ui/PauseMenu.tscn`)\n   - Added \"Difficulty\" button between Controls and Quit\n\n4. **Conditional Distraction Attack** (`scripts/objects/enemy.gd`)\n   - Added difficulty check before distraction attack logic\n   - Only triggers immediate attack in Hard mode\n\n5. **Conditional Ammo Limits** (`scripts/characters/player.gd`)\n   - Max ammo now depends on difficulty (90 Normal, 60 Hard)\n   - Responds to mid-game difficulty changes\n\n6. **Previous Implementation** (still included)\n   - Player distraction detection (`_is_player_distracted()`)\n   - GOAP integration with `AttackDistractedPlayerAction`\n   - Unit tests for the distraction attack system\n\n## Test Plan\n\n- [x] Run GUT unit tests (automated via CI)\n- [ ] Manual test: Press ESC â†’ Difficulty â†’ select Hard mode\n- [ ] Manual test: Enemy attacks immediately when player turns aim away (Hard mode only)\n- [ ] Manual test: Normal behavior when player aims at enemy\n- [ ] Manual test: Verify player has 90 bullets in Normal, 60 in Hard\n- [ ] Manual test: Switch difficulty mid-game and verify ammo updates\n\n## Fixes\n\nFixes #114\n\n---\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)","changedFiles":13,"createdAt":"2026-01-18T10:25:08Z","deletions":3,"files":[{"path":"docs/case-studies/issue-114/README.md","additions":236,"deletions":0},{"path":"docs/case-studies/issue-114/logs/game_log_20260118_135255.txt","additions":8933,"deletions":0},{"path":"docs/case-studies/issue-114/logs/game_log_20260118_140230.txt","additions":802,"deletions":0},{"path":"project.godot","additions":1,"deletions":0},{"path":"scenes/ui/DifficultyMenu.tscn","additions":72,"deletions":0},{"path":"scenes/ui/PauseMenu.tscn","additions":5,"deletions":0},{"path":"scripts/ai/enemy_actions.gd","additions":25,"deletions":0},{"path":"scripts/autoload/difficulty_manager.gd","additions":117,"deletions":0},{"path":"scripts/characters/player.gd","additions":29,"deletions":1},{"path":"scripts/objects/enemy.gd","additions":99,"deletions":1},{"path":"scripts/ui/difficulty_menu.gd","additions":77,"deletions":0},{"path":"scripts/ui/pause_menu.gd","additions":36,"deletions":0},{"path":"tests/unit/test_enemy_actions.gd","additions":86,"deletions":1}],"mergedAt":"2026-01-18T11:45:00Z","title":"Add difficulty selection with distraction attack on Hard mode"}
