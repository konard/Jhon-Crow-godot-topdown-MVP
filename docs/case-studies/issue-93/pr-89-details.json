{"url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/pulls/89","id":3184624177,"node_id":"PR_kwDOQ35BQ8690YIx","html_url":"https://github.com/Jhon-Crow/godot-topdown-MVP/pull/89","diff_url":"https://github.com/Jhon-Crow/godot-topdown-MVP/pull/89.diff","patch_url":"https://github.com/Jhon-Crow/godot-topdown-MVP/pull/89.patch","issue_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/issues/89","number":89,"state":"closed","locked":false,"title":"Add PURSUING and ASSAULT states for improved enemy AI combat behavior","user":{"login":"konard","id":1431904,"node_id":"MDQ6VXNlcjE0MzE5MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1431904?v=4","gravatar_id":"","url":"https://api.github.com/users/konard","html_url":"https://github.com/konard","followers_url":"https://api.github.com/users/konard/followers","following_url":"https://api.github.com/users/konard/following{/other_user}","gists_url":"https://api.github.com/users/konard/gists{/gist_id}","starred_url":"https://api.github.com/users/konard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/konard/subscriptions","organizations_url":"https://api.github.com/users/konard/orgs","repos_url":"https://api.github.com/users/konard/repos","events_url":"https://api.github.com/users/konard/events{/privacy}","received_events_url":"https://api.github.com/users/konard/received_events","type":"User","user_view_type":"public","site_admin":false},"body":"## Summary\n\nImplements enhanced enemy AI combat behavior with three major improvements:\n\n- **Combat Cover Cycling with Approach Phase**: In COMBAT state, enemies now:\n  1. First approach the player (moving toward them while shooting)\n  2. Once close enough (250px) or after 2 seconds of approaching, enter exposed shooting phase\n  3. Stand and shoot for 2-3 seconds (randomized)\n  4. Return to cover\n  \n  This creates more dynamic combat where enemies actively engage the player instead of standing still.\n\n- **Pursuit State (PURSUING)**: When enemies are far from the player and cannot hit them from their current position, they move cover-to-cover toward the player:\n  - Wait 1.5 seconds at each cover position\n  - Move to the next cover that's closer to the player\n  - If no closer cover found, fallback to combat or flanking\n  - Debug labels show (WAIT Xs) or (MOVING) phases\n\n- **Assault State (ASSAULT)**: When 2+ enemies are in combat simultaneously, they coordinate an assault:\n  - Take closest safe covers to the player\n  - Wait 5 seconds\n  - Rush the player together while shooting\n\n### Bug Fixes (Latest Commit)\n\n**Fixed infinite timer loop where enemies would stand behind cover cycling the timer without moving:**\n\n1. **PURSUING state visibility bug**: Removed `or not _is_visible_from_player()` check from \"reached cover\" condition. Enemies start hidden from player, so this check was immediately true, causing them to never actually move to their target cover.\n\n2. **PURSUING state minimum distance**: Added 30px minimum distance check for pursuit cover candidates. This prevents finding covers too close to current position which caused immediate \"arrival\" and restarted the waiting loop.\n\n3. **COMBAT state transition**: Changed to transition to PURSUING (not FLANKING/IDLE) when player is not visible. PURSUING is the correct state for chasing a hidden player.\n\n### Technical Changes\n\n- Added `PURSUING` and `ASSAULT` states to the `AIState` enum\n- Combat approach phase variables: `_combat_approaching`, `_combat_approach_timer`\n- Constants: `COMBAT_APPROACH_MAX_TIME` (2.0s), `COMBAT_DIRECT_CONTACT_DISTANCE` (250px)\n- `PURSUIT_COVER_WAIT_DURATION` set to 1.5s\n- Added 30px minimum distance for pursuit cover selection\n- Updated debug labels to show current phase for COMBAT and PURSUING states\n- Added detailed case study documentation in `docs/case-studies/issue-88/`\n\nFixes #88\n\n## Test plan\n\n- [x] Enable debug mode (F7) to see AI state labels above enemies\n- [ ] Test PURSUING state:\n  - Enemy should wait briefly at cover (WAIT Xs visible)\n  - Enemy should MOVE to next cover (not instantly arrive)\n  - If no cover available, should transition to COMBAT or FLANKING\n- [ ] Test COMBAT state:\n  - Enemy should approach player (APPROACH phase visible in label)\n  - Then stand and shoot (EXPOSED Xs visible)\n  - Then return to cover\n  - If player hides, should transition to PURSUING\n- [ ] Test multiple enemies (2+): should coordinate and enter ASSAULT state\n- [ ] Verify existing behaviors (RETREATING, SUPPRESSED, FLANKING) still work correctly\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)","created_at":"2026-01-17T21:48:52Z","updated_at":"2026-01-17T22:51:35Z","closed_at":"2026-01-17T22:51:34Z","merged_at":"2026-01-17T22:51:34Z","merge_commit_sha":"44a008df329e7b6697e8455e060c0112ffb6d309","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[],"milestone":null,"draft":false,"commits_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/pulls/89/commits","review_comments_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/pulls/89/comments","review_comment_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/pulls/comments{/number}","comments_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/issues/89/comments","statuses_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/statuses/22fbf504d183419e08d1a3367e2c2592d2d0024f","head":{"label":"konard:issue-88-77fcbdf439e0","ref":"issue-88-77fcbdf439e0","sha":"22fbf504d183419e08d1a3367e2c2592d2d0024f","user":{"login":"konard","id":1431904,"node_id":"MDQ6VXNlcjE0MzE5MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1431904?v=4","gravatar_id":"","url":"https://api.github.com/users/konard","html_url":"https://github.com/konard","followers_url":"https://api.github.com/users/konard/followers","following_url":"https://api.github.com/users/konard/following{/other_user}","gists_url":"https://api.github.com/users/konard/gists{/gist_id}","starred_url":"https://api.github.com/users/konard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/konard/subscriptions","organizations_url":"https://api.github.com/users/konard/orgs","repos_url":"https://api.github.com/users/konard/repos","events_url":"https://api.github.com/users/konard/events{/privacy}","received_events_url":"https://api.github.com/users/konard/received_events","type":"User","user_view_type":"public","site_admin":false},"repo":{"id":1132349649,"node_id":"R_kgDOQ35I0Q","name":"Jhon-Crow-godot-topdown-MVP","full_name":"konard/Jhon-Crow-godot-topdown-MVP","private":false,"owner":{"login":"konard","id":1431904,"node_id":"MDQ6VXNlcjE0MzE5MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1431904?v=4","gravatar_id":"","url":"https://api.github.com/users/konard","html_url":"https://github.com/konard","followers_url":"https://api.github.com/users/konard/followers","following_url":"https://api.github.com/users/konard/following{/other_user}","gists_url":"https://api.github.com/users/konard/gists{/gist_id}","starred_url":"https://api.github.com/users/konard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/konard/subscriptions","organizations_url":"https://api.github.com/users/konard/orgs","repos_url":"https://api.github.com/users/konard/repos","events_url":"https://api.github.com/users/konard/events{/privacy}","received_events_url":"https://api.github.com/users/konard/received_events","type":"User","user_view_type":"public","site_admin":false},"html_url":"https://github.com/konard/Jhon-Crow-godot-topdown-MVP","description":null,"fork":true,"url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP","forks_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/forks","keys_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/keys{/key_id}","collaborators_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/teams","hooks_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/hooks","issue_events_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/issues/events{/number}","events_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/events","assignees_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/assignees{/user}","branches_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/branches{/branch}","tags_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/tags","blobs_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/git/refs{/sha}","trees_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/git/trees{/sha}","statuses_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/statuses/{sha}","languages_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/languages","stargazers_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/stargazers","contributors_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/contributors","subscribers_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/subscribers","subscription_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/subscription","commits_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/commits{/sha}","git_commits_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/git/commits{/sha}","comments_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/comments{/number}","issue_comment_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/issues/comments{/number}","contents_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/contents/{+path}","compare_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/compare/{base}...{head}","merges_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/merges","archive_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/downloads","issues_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/issues{/number}","pulls_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/pulls{/number}","milestones_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/milestones{/number}","notifications_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/labels{/name}","releases_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/releases{/id}","deployments_url":"https://api.github.com/repos/konard/Jhon-Crow-godot-topdown-MVP/deployments","created_at":"2026-01-11T19:48:00Z","updated_at":"2026-01-18T03:36:09Z","pushed_at":"2026-01-18T03:36:07Z","git_url":"git://github.com/konard/Jhon-Crow-godot-topdown-MVP.git","ssh_url":"git@github.com:konard/Jhon-Crow-godot-topdown-MVP.git","clone_url":"https://github.com/konard/Jhon-Crow-godot-topdown-MVP.git","svn_url":"https://github.com/konard/Jhon-Crow-godot-topdown-MVP","homepage":null,"size":3250,"stargazers_count":0,"watchers_count":0,"language":"GDScript","has_issues":false,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":0,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":0,"license":{"key":"unlicense","name":"The Unlicense","spdx_id":"Unlicense","url":"https://api.github.com/licenses/unlicense","node_id":"MDc6TGljZW5zZTE1"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":0,"open_issues":0,"watchers":0,"default_branch":"main"}},"base":{"label":"Jhon-Crow:main","ref":"main","sha":"096d191950c39114a411ae8a792058a4a99931c0","user":{"login":"Jhon-Crow","id":133867474,"node_id":"U_kgDOB_qn0g","avatar_url":"https://avatars.githubusercontent.com/u/133867474?v=4","gravatar_id":"","url":"https://api.github.com/users/Jhon-Crow","html_url":"https://github.com/Jhon-Crow","followers_url":"https://api.github.com/users/Jhon-Crow/followers","following_url":"https://api.github.com/users/Jhon-Crow/following{/other_user}","gists_url":"https://api.github.com/users/Jhon-Crow/gists{/gist_id}","starred_url":"https://api.github.com/users/Jhon-Crow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jhon-Crow/subscriptions","organizations_url":"https://api.github.com/users/Jhon-Crow/orgs","repos_url":"https://api.github.com/users/Jhon-Crow/repos","events_url":"https://api.github.com/users/Jhon-Crow/events{/privacy}","received_events_url":"https://api.github.com/users/Jhon-Crow/received_events","type":"User","user_view_type":"public","site_admin":false},"repo":{"id":1132347715,"node_id":"R_kgDOQ35BQw","name":"godot-topdown-MVP","full_name":"Jhon-Crow/godot-topdown-MVP","private":false,"owner":{"login":"Jhon-Crow","id":133867474,"node_id":"U_kgDOB_qn0g","avatar_url":"https://avatars.githubusercontent.com/u/133867474?v=4","gravatar_id":"","url":"https://api.github.com/users/Jhon-Crow","html_url":"https://github.com/Jhon-Crow","followers_url":"https://api.github.com/users/Jhon-Crow/followers","following_url":"https://api.github.com/users/Jhon-Crow/following{/other_user}","gists_url":"https://api.github.com/users/Jhon-Crow/gists{/gist_id}","starred_url":"https://api.github.com/users/Jhon-Crow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jhon-Crow/subscriptions","organizations_url":"https://api.github.com/users/Jhon-Crow/orgs","repos_url":"https://api.github.com/users/Jhon-Crow/repos","events_url":"https://api.github.com/users/Jhon-Crow/events{/privacy}","received_events_url":"https://api.github.com/users/Jhon-Crow/received_events","type":"User","user_view_type":"public","site_admin":false},"html_url":"https://github.com/Jhon-Crow/godot-topdown-MVP","description":null,"fork":false,"url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP","forks_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/forks","keys_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/keys{/key_id}","collaborators_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/teams","hooks_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/hooks","issue_events_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/issues/events{/number}","events_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/events","assignees_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/assignees{/user}","branches_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/branches{/branch}","tags_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/tags","blobs_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/git/refs{/sha}","trees_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/git/trees{/sha}","statuses_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/statuses/{sha}","languages_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/languages","stargazers_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/stargazers","contributors_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/contributors","subscribers_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/subscribers","subscription_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/subscription","commits_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/commits{/sha}","git_commits_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/git/commits{/sha}","comments_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/comments{/number}","issue_comment_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/issues/comments{/number}","contents_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/contents/{+path}","compare_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/compare/{base}...{head}","merges_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/merges","archive_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/downloads","issues_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/issues{/number}","pulls_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/pulls{/number}","milestones_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/milestones{/number}","notifications_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/labels{/name}","releases_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/releases{/id}","deployments_url":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/deployments","created_at":"2026-01-11T19:42:38Z","updated_at":"2026-01-18T03:34:54Z","pushed_at":"2026-01-18T03:34:50Z","git_url":"git://github.com/Jhon-Crow/godot-topdown-MVP.git","ssh_url":"git@github.com:Jhon-Crow/godot-topdown-MVP.git","clone_url":"https://github.com/Jhon-Crow/godot-topdown-MVP.git","svn_url":"https://github.com/Jhon-Crow/godot-topdown-MVP","homepage":null,"size":3185,"stargazers_count":0,"watchers_count":0,"language":"GDScript","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":1,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":27,"license":{"key":"unlicense","name":"The Unlicense","spdx_id":"Unlicense","url":"https://api.github.com/licenses/unlicense","node_id":"MDc6TGljZW5zZTE1"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":1,"open_issues":27,"watchers":0,"default_branch":"main"}},"_links":{"self":{"href":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/pulls/89"},"html":{"href":"https://github.com/Jhon-Crow/godot-topdown-MVP/pull/89"},"issue":{"href":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/issues/89"},"comments":{"href":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/issues/89/comments"},"review_comments":{"href":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/pulls/89/comments"},"review_comment":{"href":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/pulls/89/commits"},"statuses":{"href":"https://api.github.com/repos/Jhon-Crow/godot-topdown-MVP/statuses/22fbf504d183419e08d1a3367e2c2592d2d0024f"}},"author_association":"CONTRIBUTOR","auto_merge":null,"active_lock_reason":null,"merged":true,"mergeable":null,"rebaseable":null,"mergeable_state":"unknown","merged_by":{"login":"Jhon-Crow","id":133867474,"node_id":"U_kgDOB_qn0g","avatar_url":"https://avatars.githubusercontent.com/u/133867474?v=4","gravatar_id":"","url":"https://api.github.com/users/Jhon-Crow","html_url":"https://github.com/Jhon-Crow","followers_url":"https://api.github.com/users/Jhon-Crow/followers","following_url":"https://api.github.com/users/Jhon-Crow/following{/other_user}","gists_url":"https://api.github.com/users/Jhon-Crow/gists{/gist_id}","starred_url":"https://api.github.com/users/Jhon-Crow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jhon-Crow/subscriptions","organizations_url":"https://api.github.com/users/Jhon-Crow/orgs","repos_url":"https://api.github.com/users/Jhon-Crow/repos","events_url":"https://api.github.com/users/Jhon-Crow/events{/privacy}","received_events_url":"https://api.github.com/users/Jhon-Crow/received_events","type":"User","user_view_type":"public","site_admin":false},"comments":9,"review_comments":0,"maintainer_can_modify":false,"commits":5,"additions":864,"deletions":19,"changed_files":3}